<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Detalhes do perfume | Zeidan Parfum</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta property="og:title" content="Zeidan Parfum | Perfumes Importados & Decants">
  <meta property="og:description" content="Encontre sua assinatura olfativa. Frascos lacrados e decants originais com envio para todo o Brasil.">
  <meta property="og:image" content="https://seusite.com/capa-compartilhamento.jpg"> <meta property="og:url" content="https://seusite.com/">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="pt_BR">
  <link rel="shortcut icon" href="logopequena.png" type="image/x-icon">

  <style>
  /* =========================================
      CSS ESPEC√çFICO DA P√ÅGINA DE PRODUTO
      ========================================= */

  /* --- 1. GALERIA PREMIUM (ESTILO FRAGRANTICA/SEPHORA) --- */
  .product-gallery {
      width: 100%;
      max-width: 450px;
      margin: 0 auto 25px auto;
  }

  /* CONTAINER: Vira um "Cart√£o" branco elegante */
.main-image-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 100%; /* Mant√©m quadrado */
    
    /* FUNDO BRANCO INTENCIONAL */
    background-color: #fff; 
    
    /* Borda arredondada suave */
    border-radius: 20px; 
    
    /* Sombra colorida para integrar com o fundo azul do site */
    /* Isso faz o branco n√£o "gritar" tanto, ele ganha um brilho azulado em volta */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 
                0 0 0 1px rgba(255,255,255,0.1); 
    
    margin-bottom: 10px;
    overflow: hidden;
}

/* IMAGEM: Normal, n√≠tida e centralizada */
.main-img {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* Centraliza perfeitamente */
    
    width: 85%;  /* Um pouco menor que a caixa para ter "respiro" */
    height: 85%;
    object-fit: contain;
}

  .main-img:hover { transform: scale(1.08); }

  /* Faixa de Miniaturas */
  .thumbnails-scroll-container {
      width: 100%;
      overflow-x: auto;
      padding: 5px;
      display: flex;
      justify-content: center; /* Centraliza as bolinhas */
  }
  .thumbnails-scroll-container::-webkit-scrollbar { display: none; } /* Esconde barra de rolagem */

  .thumbnails-track {
      display: flex;
      gap: 12px;
  }

  .thumb-item {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      border: 2px solid transparent; 
      transition: all 0.2s;
  }

  .thumb-item img {
      width: 80%;
      height: 80%;
      object-fit: contain;
  }

  /* Miniatura Selecionada (Dourada) */
  .thumb-item.active {
      border-color: #C5A059; 
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(197, 160, 89, 0.25);
  }

  /* --- 2. SUGEST√ïES (QUEM GOSTOU DESTE...) --- */
  #lista-sugestoes {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
  }

  /* --- 3. AJUSTES PARA CELULAR (RESPONSIVIDADE) --- */
  @media (max-width: 768px) {
    /* Ajuste da Galeria no Celular */
    .product-gallery { max-width: 100%; }
    
    /* Textos com margem segura */
    .product-detail-content {
      padding: 0 15px !important;
      box-sizing: border-box !important;
      width: 100% !important;
    }

    /* Sugest√µes viram carrossel no celular */
    #lista-sugestoes {
      flex-wrap: nowrap !important;
      justify-content: flex-start !important;
      overflow-x: auto;
      padding-bottom: 15px;
      scroll-snap-type: x mandatory;
    }
    #lista-sugestoes a {
      flex: 0 0 auto;
      scroll-snap-align: center;
    }

    /* Header Compacto */
    .site-header .hero-inner { padding-top: -100px !important; padding-bottom: 10px !important; }
    .logo { max-width: 150px !important; }
    
    /* Espa√ßamento do T√≠tulo */
    .product-detail-title { margin-top: 20px !important; line-height: 1.3 !important; }
  }
  </style>
</head>

<style>
    @media (max-width: 768px) {
      /* 1. Puxa a Logo para cima */
      .logo-wrap {
          margin-top: 20px !important; /* Reduzi de 150px para 80px */
          margin-bottom: 10px !important; /* Remove espa√ßo extra embaixo da logo */
      }

      /* 2. Puxa o Produto para colar na Logo */
      .product-detail {
          margin-top: 0 !important;
          padding-top: 0 !important;
      }
      
      /* 3. Ajuste de seguran√ßa para o menu n√£o ficar em cima da logo */
      .hero-bar {
          position: absolute !important; /* Solta o menu para n√£o empurrar nada */
      }
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <div class="top-bar-inner">
      <p class="top-message">
        ENTRE EM CONTATO COM A NOSSA EQUIPE PARA ENCOMENDAR O SEU PERFUME - (31) 99166-8430
      </p>
    </div>
  </div>

  <header class="site-header">
    <div class="hero-inner">
      <div class="logo-wrap">
        <a href="index.html">
            <img src="logo.png" alt="ZEIDAN PARFUM" class="logo" />
        </a>
      </div>
      <nav class="main-nav">
        <a href="index.html" class="nav-link">In√≠cio</a>
        <a href="contato.html" class="nav-link">Contato</a>
      </nav>
    </div>
  </header>

  <main class="page-content">
    
    <section id="marcas" class="brand-panel">
      <div class="brand-panel-inner">
        <div id="brandColumns" class="brand-columns"></div>
      </div>
    </section>

    <section class="product-detail">
      <div class="product-detail-inner">
        
        <div class="product-detail-image">
          <div class="product-gallery">
              <div class="main-image-container">
                  <img id="main-product-img" src="" alt="Carregando..." class="main-img">
              </div>
              <div class="thumbnails-scroll-container">
                  <div class="thumbnails-track" id="thumbnails-track"></div>
              </div>
          </div>
        </div>

        <div class="product-detail-content">
          <h1 id="produtoTitulo" class="product-detail-title">Carregando...</h1>
          <p id="produtoMarca" class="product-detail-brand"></p>
          <p id="produtoPreco" class="product-detail-price"></p>
          <div id="box-decants" class="version-selector-container" style="display: none; margin: 20px 0;">
    <div class="selector-label" style="font-size: 12px; color: #ffffff; text-transform: uppercase; margin-bottom: 10px; font-weight: 700;">Escolha a vers√£o:</div>
    
    <div class="version-options" style="display: flex; gap: 10px; flex-wrap: wrap;">
        <label class="version-option active" onclick="selecionarVersao('frasco')" style="flex: 1; min-width: 100px; background: #111; border: 1px solid #444; border-radius: 8px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center;">
            <input type="radio" name="versao" checked hidden>
            <span class="v-name" style="font-size: 13px; color: #fff; font-weight: 600;">Frasco Lacrado</span>
            <span class="v-tag" style="font-size: 9px; background: #C5A059; color: #000; padding: 2px 6px; border-radius: 4px; font-weight: 800; text-transform: uppercase; margin-top: 4px;">Original</span>
        </label>

        <label id="label-decant5" class="version-option" onclick="selecionarVersao('decant5')" style="flex: 1; min-width: 100px; background: #111; border: 1px solid #444; border-radius: 8px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center;">
            <input type="radio" name="versao" hidden>
            <span class="v-name" style="font-size: 13px; color: #fff; font-weight: 600;">Decant (5ml)</span>
            <span class="v-tag" style="font-size: 9px; background: #2ecc71; color: #000; padding: 2px 6px; border-radius: 4px; font-weight: 800; text-transform: uppercase; margin-top: 4px;">Provador</span>
        </label>

        <label id="label-decant10" class="version-option" onclick="selecionarVersao('decant10')" style="flex: 1; min-width: 100px; background: #111; border: 1px solid #444; border-radius: 8px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center;">
            <input type="radio" name="versao" hidden>
            <span class="v-name" style="font-size: 13px; color: #fff; font-weight: 600;">Decant (10ml)</span>
            <span class="v-tag" style="font-size: 9px; background: #3498db; color: #000; padding: 2px 6px; border-radius: 4px; font-weight: 800; text-transform: uppercase; margin-top: 4px;">Econ√¥mico</span>
        </label>
    </div>
</div>
          <p id="produtoDescricao" class="product-detail-description" style="text-align: justify;"></p>

          <h3 class="product-detail-subtitle">Principais acordes</h3>
          <p id="produtoAcordes" class="product-detail-accords" style="margin-top: 5px; color: #fff; text-align: center;"></p>

          <h3 class="product-detail-subtitle">Pir√¢mide olfativa</h3>
          <p id="produtoNotas" class="product-detail-notes" style="text-align: center;"></p>
          
          <h3 class="product-detail-subtitle" style="margin-top: 20px;">Especifica√ß√µes</h3>
          <ul class="product-specs" style="list-style: none; padding: 0; color: #ccc; text-align: center;">
            <li style="margin-bottom: 8px;"><strong style="color: #fff;">Estilo:</strong> <span id="produtoEstilo">-</span></li>
            <li style="margin-bottom: 8px;"><strong style="color: #fff;">Ocasi√£o:</strong> <span id="produtoOcasiao">-</span></li>
            <li><strong style="color: #fff;">Intensidade:</strong> <span id="produtoIntensidade">-</span></li>
          </ul>

          <div class="product-detail-actions">
            <a id="produtoWhatsapp" href="#" class="product-btn">Encomende <i class="fa-solid fa-cart-plus"></i></a>
            <a id="produtoComprar" href="#" class="product-btn" style="margin-top:10px;">Comprar</a>
          </div>

          <div id="box-sugestoes" style="display: none; margin-top: 40px; border-top: 1px solid #333; padding-top: 20px;">
            <h3 class="product-detail-subtitle" style="text-align: center; margin-bottom: 20px;">Quem gosta deste, tamb√©m gosta de:</h3>
            <div id="lista-sugestoes"></div>
          </div>

          <a href="index.html" class="contact-back">‚Üê Voltar para a vitrine</a>
        </div> 
      </div>
    </section>
  </main>

  <div class="image-modal" id="imageModal">
    <div class="image-modal-backdrop" id="imageModalBackdrop"></div>
    <div class="image-modal-content">
      <button class="image-modal-close" id="imageModalClose">√ó</button>
      <img id="imageModalImg" src="" alt="">
    </div>
  </div>

  <div class="cart-floating-btn" onclick="toggleCart()">
    <i class="fa-solid fa-cart-shopping"></i>
    <span id="cart-count">0</span>
  </div>

  <div id="cart-modal" class="cart-modal-overlay">
    <div class="cart-modal-content">
      <div class="cart-header">
        <h3>Minha Sacola</h3>
        <button onclick="toggleCart()" class="close-cart">‚úï</button>
      </div>
      <div id="cart-items" class="cart-items-container">
        <p class="empty-msg">Sua sacola est√° vazia üõçÔ∏è</p>
      </div>
      <div class="cart-footer">
        <div class="cart-total" style="display: flex; justify-content: space-between; margin-bottom: 15px; border-top: 1px solid #eee; padding-top: 15px;">
    <span style="font-size: 16px; font-weight: 600;">Subtotal:</span>
    <span id="cart-total-value" style="font-size: 18px; font-weight: 800; color: #000;">R$ 0,00</span>
</div>
        <button onclick="finalizarNoZap()" class="btn-whatsapp-checkout">
          <i class="fa-brands fa-whatsapp"></i> Finalizar Pedido
        </button>
        <button onclick="toggleCart()" class="btn-continue">Continuar Comprando</button>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-inner">
      <a href="https://instagram.com/zeidanparfum" target="_blank" class="footer-instagram">
        <img src="instagram.png" alt="Instagram" class="footer-instagram-img">
      </a>
      <div class="footer-columns">
        <div class="footer-column">
          <h4 class="footer-title">MENU</h4>
          <a href="index.html" class="footer-link">In√≠cio</a>
          <a href="contato.html" class="footer-link">Contato</a>
        </div>
      </div>
      <div class="payment-bar-container">
        <div class="payment-text">FORMAS DE PAGAMENTO</div>
        <div class="payment-icons">
          <img src="mastercard.png" alt="Mastercard">
          <img src="visa.png" alt="Visa">
          <img src="amex.png" alt="Amex">
          <img src="elo.png" alt="Elo">
          <img src="pix.png" alt="Pix">
        </div>
        <div class="security-badge-css">
          <div class="lock-icon"><i class="fa-solid fa-lock"></i></div>
          <div class="security-text-css"><span>SITE</span> <strong>100% SEGURO</strong></div>
        </div>
      </div>
      <p class="footer-copy">Copyright ZEIDAN PARFUM - 2025. Todos os direitos reservados.</p>
    </div>
  </footer>

  <script>
    // 1. Array que guarda os produtos (L√™ da mem√≥ria do navegador)
    let carrinho = JSON.parse(localStorage.getItem('carrinhoZeidan')) || [];

    // 2. Atualiza o visual da sacola
    function atualizarCarrinhoUI() {
        const container = document.getElementById('cart-items');
        const contador = document.getElementById('cart-count');
        const totalDisplay = document.getElementById('cart-total-value');
        
        localStorage.setItem('carrinhoZeidan', JSON.stringify(carrinho));

        // Bolinha vermelha (some se zero)
        if (contador) {
            contador.innerText = carrinho.length;
            contador.style.display = carrinho.length > 0 ? 'flex' : 'none';
        }

        if (!container) return;

        if (carrinho.length === 0) {
            container.innerHTML = '<div style="text-align:center; padding:40px 20px; color:#888;"><i class="fa-solid fa-basket-shopping" style="font-size:40px; margin-bottom:10px; opacity:0.5;"></i><p>Sua sacola est√° vazia.</p></div>';
            if(totalDisplay) totalDisplay.innerText = "R$ 0,00";
            return;
        }

        let html = '';
        let total = 0;

        carrinho.forEach((item, index) => {
            let precoNumerico = 0;
            try {
                let limpo = item.preco.toString().replace('R$', '').replace(/\./g, '').replace(',', '.').trim();
                precoNumerico = parseFloat(limpo);
            } catch(e) { precoNumerico = 0; }
            
            if (!isNaN(precoNumerico)) total += precoNumerico;

            // Visual: Marca Pequena / Nome Grande
            let nomeExibicao = item.produto || item.nome || "Produto";

            html += `
                <div class="cart-item" style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid #eee;">
                    <div style="flex:1; padding-right:10px;">
                        <div style="font-size:10px; color:#999; text-transform:uppercase; font-weight:700; margin-bottom:2px;">
                            ${item.marca}
                        </div>
                        <div style="font-weight:600; font-size:13px; color:#000; line-height:1.3;">
                            ${nomeExibicao}
                        </div>
                    </div>
                    <div style="text-align:right; display:flex; flex-direction:column; align-items:flex-end; gap:5px;">
                        <div style="font-weight:700; color:#333; font-size:14px;">${item.preco}</div>
                        <button onclick="window.removerDoCarrinho(${index})" style="color:#ff4757; background:none; border:none; font-size:11px; cursor:pointer; text-decoration:underline; padding:0;">
                            Remover
                        </button>
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
        if(totalDisplay) totalDisplay.innerText = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // 3. Fun√ß√£o Global para Adicionar (Silenciosa + Anima√ß√£o)
    window.adicionarAoCarrinho = function(marca, produto, preco, botao) {
        carrinho.push({ marca, produto, preco });
        atualizarCarrinhoUI();

        // Anima√ß√£o √çcone Carrinho
        const cartIcon = document.querySelector('.cart-floating-btn i') || document.querySelector('.fa-cart-shopping');
        if (cartIcon) {
            cartIcon.style.transition = "transform 0.2s, color 0.2s";
            cartIcon.style.transform = "scale(1.4)";
            cartIcon.style.color = "#2ecc71";
            setTimeout(() => {
                cartIcon.style.transform = "scale(1)";
                cartIcon.style.color = "";
            }, 300);
        }

        // Anima√ß√£o Bot√£o (Se passado)
        if (botao) {
           const textoOriginal = botao.innerHTML;
           botao.innerHTML = 'Adicionado! <i class="fa-solid fa-check"></i>';
           botao.style.background = '#2ecc71';
           botao.style.color = '#fff';
           setTimeout(() => {
               botao.innerHTML = textoOriginal;
               botao.style.background = '';
               botao.style.color = '';
           }, 1500);
        }
    };

    // 4. Remove item
    window.removerDoCarrinho = function(index) {
        carrinho.splice(index, 1);
        atualizarCarrinhoUI();
    };

    // 5. Abre e Fecha a Janela (COM CORRE√á√ÉO DO ZAP)
    window.toggleCart = function() {
        const modal = document.getElementById('cart-modal');
        const widgetZap = document.querySelector('.whatsapp-widget'); // Pega o bot√£o do zap
        
        if (!modal) return;
        
        if (modal.style.display === 'flex') {
            // FECHANDO O CARRINHO
            modal.style.display = 'none';
            if(widgetZap) widgetZap.style.display = 'block'; // Mostra o zap de volta
        } else {
            // ABRINDO O CARRINHO
            modal.style.display = 'flex';
            if(widgetZap) widgetZap.style.display = 'none'; // Esconde o zap pra n√£o atrapalhar
            atualizarCarrinhoUI();
        }
    };

    // 6. Bot√£o Finalizar no WhatsApp
    window.finalizarNoZap = function() {
        if (carrinho.length === 0) return alert("Sua sacola est√° vazia!");

        let mensagem = "Ol√° Zeidan! Gostaria de verificar a disponibilidade destes perfumes:\n\n";
        let totalEstimado = 0;

        carrinho.forEach(item => {
            mensagem += `‚ñ™Ô∏è *${item.produto}* (${item.marca}) - ${item.preco}\n`;
            try {
                let limpo = item.preco.toString().replace('R$', '').replace(/\./g, '').replace(',', '.').trim();
                let valor = parseFloat(limpo);
                if(!isNaN(valor)) totalEstimado += valor;
            } catch(e){}
        });

        mensagem += `\nüí∞ *Total Estimado:* ${totalEstimado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
        mensagem += `\n\nAguardo a confirma√ß√£o e o link de pagamento!`;

        let telefone = "5531991668430"; 
        let url = `https://wa.me/${telefone}?text=${encodeURIComponent(mensagem)}`;
        window.open(url, '_blank');
    };

    document.addEventListener("DOMContentLoaded", atualizarCarrinhoUI);
  </script>

  <script>
    // === L√ìGICA DE CARREGAMENTO INTELIGENTE (H√çBRIDA) ===
    // --- VARI√ÅVEIS GLOBAIS DE SELE√á√ÉO ---
    let produtoAtualDados = {}; 
    let versaoAtualSelecionada = ""; // Guarda se √© "Frasco", "Decant 5ml", etc.
    let precoAtualSelecionado = "";  // Guarda o pre√ßo atual (R$ 350 ou R$ 45)

    // --- FUN√á√ÉO 1: VERIFICA SE TEM DECANT ---
    function verificarDisponibilidadeDecants(p) {
        produtoAtualDados = p; 
        const boxDecants = document.getElementById('box-decants');
        const btn5ml = document.getElementById('label-decant5');
        const btn10ml = document.getElementById('label-decant10');

        // Reseta sempre para o Frasco ao carregar
        selecionarVersao('frasco');

        // Verifica se existe pre√ßo e se n√£o est√° vazio
        const temDecant5 = p.Decant5ml && p.Decant5ml.toString().trim() !== "";
        const temDecant10 = p.Decant10ml && p.Decant10ml.toString().trim() !== "";

        // Mostra/Esconde bot√µes individuais
        if(btn5ml) btn5ml.style.display = temDecant5 ? 'flex' : 'none';
        if(btn10ml) btn10ml.style.display = temDecant10 ? 'flex' : 'none';

        // Se tiver pelo menos um decant, mostra a caixa. Se n√£o, esconde.
        if (boxDecants) {
            boxDecants.style.display = (temDecant5 || temDecant10) ? 'block' : 'none';
        }
    }

    // --- FUN√á√ÉO 2: CLIQUE NO BOT√ÉO ---
    function selecionarVersao(tipo) {
        // Visual dos bot√µes (Dourado no ativo)
        document.querySelectorAll('.version-option').forEach(el => {
            el.style.borderColor = "#444";
            el.style.background = "#111";
            el.classList.remove('active');
        });

        // Tenta achar o bot√£o clicado ou o padr√£o
        let elAtivo;
        if (event && event.currentTarget) elAtivo = event.currentTarget;
        else elAtivo = document.querySelector('.version-option'); // Padr√£o (primeiro)

        if(elAtivo) {
            elAtivo.classList.add('active');
            elAtivo.style.borderColor = "#C5A059";
            elAtivo.style.background = "rgba(197, 160, 89, 0.1)";
        }

        const displayPreco = document.getElementById("produtoPreco");
        
        // Salva pre√ßo original do frasco na primeira vez
        if (!window.precoFrascoOriginal && displayPreco) {
            window.precoFrascoOriginal = displayPreco.textContent;
        }

        // Define valores baseados na escolha
        if (tipo === 'frasco') {
            versaoAtualSelecionada = "Frasco Lacrado";
            precoAtualSelecionado = window.precoFrascoOriginal || produtoAtualDados.Preco_Venda;
            if(displayPreco) displayPreco.style.color = "#fff";
        } 
        else if (tipo === 'decant5') {
            versaoAtualSelecionada = "Decant (5ml)";
            precoAtualSelecionado = produtoAtualDados.Decant5ml;
            if(displayPreco) displayPreco.style.color = "#ffffff";
        } 
        else if (tipo === 'decant10') {
            versaoAtualSelecionada = "Decant (10ml)";
            precoAtualSelecionado = produtoAtualDados.Decant10ml;
            if(displayPreco) displayPreco.style.color = "#ffffff";
        }

        // Atualiza Texto na Tela
        if(displayPreco) displayPreco.textContent = precoAtualSelecionado;
    }
    const params = new URLSearchParams(window.location.search);
    const idUrl = params.get("id");

    async function carregarProduto() {
      try {
        const resp = await fetch("data.json");
        const lista = await resp.json();
        let p = null;

        // 1. TENTATIVA: Pelo SLUG (Link novo: 'afnan-9pm')
        if (idUrl) {
            p = lista.find(item => item.id_slug === idUrl);
        }

        // 2. TENTATIVA: Pelo NOME (Link antigo/Cache: 'Afnan%209PM')
        if (!p && idUrl) {
            const idDecodificado = decodeURIComponent(idUrl);
            p = lista.find(item => (item.Produto || "").toUpperCase() === idDecodificado.toUpperCase());
        }

        // 3. TENTATIVA: Limpeza bruta (Remove tra√ßos e compara)
        if (!p && idUrl) {
             const idLimpo = idUrl.toLowerCase().replace(/-/g, ' ');
             p = lista.find(item => (item.Produto || "").toLowerCase() === idLimpo);
        }

        // SE N√ÉO ACHAR NADA
        if (!p) {
          document.getElementById("produtoTitulo").textContent = "Produto n√£o encontrado";
          document.querySelector(".product-detail-content").style.opacity = "0.5";
          return;
        }

        // --- PREENCHE OS TEXTOS ---
        document.title = (p.Produto || "Detalhes") + " | Zeidan Parfum";
        document.getElementById("produtoTitulo").textContent = p.Produto || "";
        document.getElementById("produtoMarca").textContent =
          (p.Marca || "") + (p.Categoria ? " ‚Ä¢ " + p.Categoria.toUpperCase() : "");
        document.getElementById("produtoPreco").textContent = p.Preco_Venda || "";
        document.getElementById("produtoDescricao").textContent = p.Descricao || "Descri√ß√£o em breve.";
        document.getElementById("produtoAcordes").textContent = p.Acordes || "-";

        // Notas
        let notasHtml = "";
        if (p.Notas_Topo) notasHtml += "<strong>Topo:</strong> " + p.Notas_Topo + "<br>";
        if (p.Notas_Coracao) notasHtml += "<strong>Cora√ß√£o:</strong> " + p.Notas_Coracao + "<br>";
        if (p.Notas_Fundo) notasHtml += "<strong>Fundo:</strong> " + p.Notas_Fundo;
        document.getElementById("produtoNotas").innerHTML = notasHtml || "-";

        document.getElementById("produtoEstilo").textContent = p.Estilo || "-";
        document.getElementById("produtoOcasiao").textContent = p.Ocasi√£o || "-";
        document.getElementById("produtoIntensidade").textContent = p.Intensidade || "-";
        verificarDisponibilidadeDecants(p);

        // === NOVO: SALVAR NO HIST√ìRICO ===
        try {
            let historico = JSON.parse(localStorage.getItem('zeidanHistorico')) || [];
            
            // 1. Remove se j√° estiver na lista (para n√£o duplicar o mesmo perfume)
            // Usamos o Slug ou o Nome como identificador
            historico = historico.filter(h => h.id_slug !== p.id_slug);
            
            // 2. Adiciona o atual no TOPO da lista
            historico.unshift({
                id_slug: p.id_slug,
                Produto: p.Produto,
                Marca: p.Marca,
                Imagem: p.Imagem,
                Preco_Venda: p.Preco_Venda,
                Categoria: p.Categoria,
                Destaque: p.Destaque // Opcional
            });

            // 3. Mant√©m apenas os √∫ltimos 6 vistos (para n√£o pesar)
            if (historico.length > 6) historico.pop();

            // 4. Salva no navegador do cliente
            localStorage.setItem('zeidanHistorico', JSON.stringify(historico));
        } catch (e) {
            console.log("Erro ao salvar hist√≥rico", e);
        }

        // --- GALERIA COM SWIPE (CORRIGIDO) ---
        montarGaleria(p);
        
        // --- ZOOM (MODO F√ÅCIL DE FECHAR) ---
        const mainImg = document.getElementById("main-product-img");
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("imageModalImg");
        const modalClose = document.getElementById("imageModalClose");
        
        // Fun√ß√£o para fechar modal
        function fecharModal() {
            if(modal) {
                modal.classList.remove("open");
                modal.style.display = "none";
            }
        }

        // Abre o Zoom (Essa l√≥gica j√° est√° conectada no Swipe/MontarGaleria, 
        // mas deixamos aqui caso precise de backup para clique simples)
        if(mainImg && modal) {
             // O clique da imagem √© gerenciado pela fun√ß√£o montarGaleria agora
             // para n√£o conflitar com o arraste
        }

        // 1. Fecha no Bot√£o X
        if(modalClose) modalClose.onclick = fecharModal;

        // 2. Fecha clicando no FUNDO ESCURO (A M√°gica ‚ú®)
        if(modal) {
            modal.onclick = function(e) {
                // Se o alvo do clique for o pr√≥prio container do modal (o fundo cinza)
                // ou o backdrop, fecha. Se for a imagem, n√£o faz nada.
                if (e.target === modal || e.target.id === "imageModalBackdrop") {
                    fecharModal();
                }
            }
        }

        // --- BOT√ïES DE A√á√ÉO (CORRIGIDO PARA PEGAR O DECANT) ---
        const btnWhatsapp = document.getElementById("produtoWhatsapp");
        const btnComprar = document.getElementById("produtoComprar");

        function acaoClicar(e) {
            e.preventDefault(); // Evita recarregar a p√°gina
            
            // 1. DEFINE O NOME DO PRODUTO
            // Come√ßa com o nome original
            let nomeFinal = (p.Produto || "").replace(/'/g, " ");
            
            // Se tiver uma vers√£o selecionada (e n√£o for o frasco normal), adiciona ao nome
            // Ex: "Lattafa Asad - Decant (5ml)"
            if (typeof versaoAtualSelecionada !== 'undefined' && versaoAtualSelecionada && versaoAtualSelecionada !== "Frasco Lacrado") {
                nomeFinal = `${nomeFinal} - ${versaoAtualSelecionada}`;
            }

            // 2. DEFINE O PRE√áO
            // Come√ßa com o pre√ßo original
            let precoFinal = p.Preco_Venda || "R$ 0,00";
            
            // Se tiver um pre√ßo de sele√ß√£o ativo, usa ele
            if (typeof precoAtualSelecionado !== 'undefined' && precoAtualSelecionado) {
                precoFinal = precoAtualSelecionado;
            }

            const marcaSafe = (p.Marca || "").replace(/'/g, " ");

            // 3. ENVIA PRO CARRINHO COM OS DADOS CERTOS
            if (typeof adicionarAoCarrinho === "function") {
                adicionarAoCarrinho(marcaSafe, nomeFinal, precoFinal, e.currentTarget);
            } else if (window.adicionarAoCarrinho) {
                 window.adicionarAoCarrinho(marcaSafe, nomeFinal, precoFinal, e.currentTarget);
            }
        }

        // Reconecta o clique dos bot√µes para usar essa nova fun√ß√£o inteligente
        if (btnWhatsapp) btnWhatsapp.onclick = acaoClicar;
        if (btnComprar) btnComprar.onclick = acaoClicar;

        // --- SUGEST√ïES ---
        const boxSugestoes = document.getElementById("box-sugestoes");
        const listaSugestoes = document.getElementById("lista-sugestoes");
        
        listaSugestoes.innerHTML = "";
        boxSugestoes.style.display = "none";

        if (p.Sugestoes && Array.isArray(p.Sugestoes) && p.Sugestoes.length > 0) {
            const recomendados = p.Sugestoes.map(nomeSugestao => {
                // Tenta achar sugest√£o por nome (mais seguro ignorar case)
                return lista.find(item => (item.Produto || "").trim().toUpperCase() === nomeSugestao.trim().toUpperCase());
            }).filter(item => item !== undefined);

            if (recomendados.length > 0) {
                boxSugestoes.style.display = "block";
                recomendados.forEach(sugestao => {
                    // LINK DA SUGEST√ÉO TAMB√âM PRECISA USAR O SLUG SE TIVER
                    const linkHref = sugestao.id_slug ? `produto.html?id=${sugestao.id_slug}` : `produto.html?id=${encodeURIComponent(sugestao.Produto)}`;
                    
                    const link = document.createElement("a");
                    link.href = linkHref;
                    link.style.textDecoration = "none";
                    link.style.width = "140px";
                    link.style.display = "flex";
                    link.style.flexDirection = "column";
                    link.style.alignItems = "center";
                    link.style.textAlign = "center";
                    link.style.flexShrink = "0";

                    const img = document.createElement("img");
                    img.src = sugestao.Imagem;
                    img.style.width = "100%";
                    img.style.height = "140px";
                    img.style.objectFit = "contain";
                    img.style.backgroundColor = "#fff";
                    img.style.borderRadius = "12px";
                    img.style.marginBottom = "8px";
                    img.style.boxShadow = "0 4px 8px rgba(0,0,0,0.1)";

                    const nome = document.createElement("span");
                    nome.innerText = sugestao.Marca || "Ver"; 
                    nome.style.color = "#fff";
                    nome.style.fontSize = "12px";
                    nome.style.fontWeight = "bold";
                    
                    const nomeProd = document.createElement("span");
                    nomeProd.innerText = sugestao.Produto; 
                    nomeProd.style.color = "#ccc";
                    nomeProd.style.fontSize = "11px";
                    nomeProd.style.marginTop = "2px";
                    nomeProd.style.overflow = "hidden";
                    nomeProd.style.textOverflow = "ellipsis";
                    nomeProd.style.whiteSpace = "nowrap";
                    nomeProd.style.width = "100%";

                    link.appendChild(img);
                    link.appendChild(nome);
                    link.appendChild(nomeProd);
                    listaSugestoes.appendChild(link);
                });
            }
        }

      } catch (e) {
        console.error("Erro:", e);
        document.getElementById("produtoTitulo").textContent = "Erro ao carregar.";
      }
    }

    // === FUN√á√ÉO DA GALERIA COM SWIPE (ARRASTE) ===
    function montarGaleria(produto) {
        const mainImg = document.getElementById('main-product-img');
        const track = document.getElementById('thumbnails-track');

        if (!mainImg || !track) return;

        // 1. Define imagem inicial
        mainImg.src = produto.Imagem || "";

        // 2. Monta Lista
        let imagens = [];
        if(produto.Imagem) imagens.push(produto.Imagem);
        if(produto.Imagem2) imagens.push(produto.Imagem2);
        if(produto.Imagem3) imagens.push(produto.Imagem3);
        if(produto.Imagem4) imagens.push(produto.Imagem4);

        if (imagens.length === 0 && produto.Imagem) imagens = [produto.Imagem];
        // Opcional: duplicar se s√≥ tiver 1
        // if (imagens.length === 1) imagens = [produto.Imagem, produto.Imagem];

        // 3. Renderiza Miniaturas
        track.innerHTML = '';
        imagens.forEach((imgSrc, index) => {
            const thumb = document.createElement('div');
            thumb.className = `thumb-item ${index === 0 ? 'active' : ''}`;
            thumb.id = `thumb-id-${index}`;
            thumb.innerHTML = `<img src="${imgSrc}" alt="Ver">`;

            thumb.onclick = function() {
                irParaFoto(index);
            };
            track.appendChild(thumb);
        });

        // Vari√°vel de controle do √≠ndice atual
        let indiceAtual = 0;

        function irParaFoto(index) {
            indiceAtual = index;
            mainImg.src = imagens[index];
            document.querySelectorAll('.thumb-item').forEach(t => t.classList.remove('active'));
            const atv = document.getElementById(`thumb-id-${index}`);
            if(atv) {
                atv.classList.add('active');
                atv.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        // 4. L√ìGICA DE SWIPE (ARRASTAR)
        let startX = 0;
        let endX = 0;

        // Touch (Celular)
        mainImg.addEventListener('touchstart', e => {
            startX = e.changedTouches[0].screenX;
        }, {passive: true});

        mainImg.addEventListener('touchend', e => {
            endX = e.changedTouches[0].screenX;
            handleSwipe();
        }, {passive: true});

        // Mouse (PC)
        mainImg.addEventListener('mousedown', e => {
            startX = e.clientX;
            e.preventDefault(); 
        });

        mainImg.addEventListener('mouseup', e => {
            endX = e.clientX;
            handleSwipe();
        });

        function handleSwipe() {
            if (Math.abs(endX - startX) < 40) {
                // Se mexeu pouco, considera clique para abrir o zoom
                const modal = document.getElementById("imageModal");
                const modalImg = document.getElementById("imageModalImg");
                if (modal && modalImg) {
                    modalImg.src = mainImg.src;
                    modal.classList.add("open");
                    modal.style.display = "flex";
                }
                return; 
            }

            if (endX < startX) {
                // Esquerda -> Pr√≥xima
                let prox = indiceAtual + 1;
                if(prox >= imagens.length) prox = 0;
                irParaFoto(prox);
            } else {
                // Direita -> Anterior
                let ant = indiceAtual - 1;
                if(ant < 0) ant = imagens.length - 1;
                irParaFoto(ant);
            }
        }
    }

    carregarProduto();
  </script>
</body>
</html>